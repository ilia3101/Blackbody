<html>

    <body onload="test()" id="Body" style="background-color: rgb(0,0,0);">

        <script>
function gamma(x) {
    return (x < 0.0031308) ? (x * 12.92) : (1.055 * Math.pow(x,1/2.4) - 0.055);
}

//d
var XYZ_match = {
    wavelength: [ 360, 365, 370, 375, 380, 385, 390, 395, 400, 405, 410, 415,
    420, 425, 430, 435, 440, 445, 450, 455, 460, 465, 470, 475, 480, 485, 490,
    495, 500, 505, 510, 515, 520, 525, 530, 535, 540, 545, 550, 555, 560, 565,
    570, 575, 580, 585, 590, 595, 600, 605, 610, 615, 620, 625, 630, 635, 640,
    645, 650, 655, 660, 665, 670, 675, 680, 685, 690, 695, 700, 705, 710, 715,
    720, 725, 730, 735, 740, 745, 750, 755, 760, 765, 770, 775, 780, 785, 790,
    795, 800, 805, 810, 815, 820, 825, 830 ],
    value_X: [ 0.0001299, 0.0002321, 0.0004149, 0.0007416, 0.001368, 0.002236,
    0.004243, 0.00765, 0.01431, 0.02319, 0.04351, 0.07763, 0.13438, 0.21477,
    0.2839, 0.3285, 0.34828, 0.34806, 0.3362, 0.3187, 0.2908, 0.2511, 0.19536,
    0.1421, 0.09564, 0.05795001, 0.03201, 0.0147, 0.0049, 0.0024, 0.0093,
    0.0291, 0.06327, 0.1096, 0.1655, 0.2257499, 0.2904, 0.3597, 0.4334499,
    0.5120501, 0.5945, 0.6784, 0.7621, 0.8425, 0.9163, 0.9786, 1.0263, 1.0567,
    1.0622, 1.0456, 1.0026, 0.9384, 0.8544499, 0.7514, 0.6424, 0.5419, 0.4479,
    0.3608, 0.2835, 0.2187, 0.1649, 0.1212, 0.0874, 0.0636, 0.04677, 0.0329,
    0.0227, 0.01584, 0.01135916, 0.008110916, 0.005790346, 0.004106457,
    0.002899327, 0.00204919, 0.001439971, 0.0009999493, 0.0006900786,
    0.0004760213, 0.0003323011, 0.0002348261, 0.0001661505, 0.000117413,
    8.307527E-05, 5.870652E-05, 4.150994E-05, 2.935326E-05, 2.067383E-05,
    1.455977E-05, 1.025398E-05, 7.221456E-06, 5.085868E-06, 3.581652E-06,
    2.522525E-06, 1.776509E-06, 1.251141E-06 ],
    value_Y: [ 3.917E-06, 6.965E-06, 1.239E-05, 2.202E-05, 3.9E-05, 6.4E-05,
    0.00012, 0.000217, 0.000396, 0.00064, 0.00121, 0.00218, 0.004, 0.0073,
    0.0116, 0.01684, 0.023, 0.0298, 0.038, 0.048, 0.06, 0.0739, 0.09098, 0.1126,
    0.13902, 0.1693, 0.20802, 0.2586, 0.323, 0.4073, 0.503, 0.6082, 0.71,
    0.7932, 0.862, 0.9148501, 0.954, 0.9803, 0.9949501, 1, 0.995, 0.9786, 0.952,
    0.9154, 0.87, 0.8163, 0.757, 0.6949, 0.631, 0.5668, 0.503, 0.4412, 0.381,
    0.321, 0.265, 0.217, 0.175, 0.1382, 0.107, 0.0816, 0.061, 0.04458, 0.032,
    0.0232, 0.017, 0.01192, 0.00821, 0.005723, 0.004102, 0.002929, 0.002091,
    0.001484, 0.001047, 0.00074, 0.00052, 0.0003611, 0.0002492, 0.0001719,
    0.00012, 8.48E-05, 6E-05, 4.24E-05, 3E-05, 2.12E-05, 1.499E-05, 1.06E-05,
    7.4657E-06, 5.2578E-06, 3.7029E-06, 2.6078E-06, 1.8366E-06, 1.2934E-06,
    9.1093E-07, 6.4153E-07, 4.5181E-07 ],
    value_Z: [ 0.0006061, 0.001086, 0.001946, 0.003486, 0.006450001, 0.01054999,
    0.02005001, 0.03621, 0.06785001, 0.1102, 0.2074, 0.3713, 0.6456, 1.0390501,
    1.3856, 1.62296, 1.74706, 1.7826, 1.77211, 1.7441, 1.6692, 1.5281, 1.28764,
    1.0419, 0.8129501, 0.6162, 0.46518, 0.3533, 0.272, 0.2123, 0.1582, 0.1117,
    0.07824999, 0.05725001, 0.04216, 0.02984, 0.0203, 0.0134, 0.008749999,
    0.005749999, 0.0039, 0.002749999, 0.0021, 0.0018, 0.001650001, 0.0014,
    0.0011, 0.001, 0.0008, 0.0006, 0.00034, 0.00024, 0.00019, 0.0001,
    4.999999E-05, 3E-05, 2E-05, 1E-05, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]
};

/*
 * http://astronomy.swin.edu.au/cosmos/B/Blackbody+Radiation
 * https://en.wikipedia.org/wiki/Black-body_radiation#Equations
 * https://en.wikipedia.org/wiki/Planck%27s_law
 */
function get_blackbody_radiation(kelvin, wavelength)
{
    /* Some constants have been made less extremely big/small */
    let h = 6.62607004e-8; /* ""Planck constant" */
    let k = 1380.64852; /* ""Boltzman constant" */
    let c = 299792458; /* Speed of light */
    let T = kelvin;
    let lambda5 = Math.pow(wavelength, 5.0); /* Wavelength ^ 5 */
    wavelength /= 1000000000; /* To metres */
    return 1.0 / (lambda5 * (Math.pow(Math.E, (h*c)/(wavelength*k*T) - 1.0)));
}

function kelvin_to_XYZ(temperature)
{
    let X = 0, Y = 0, Z = 0;

    for (let w = 0; w < XYZ_match.wavelength.length; w++)
    {
        let wavelength = XYZ_match.wavelength[w];
        let radiation = get_blackbody_radiation(temperature, wavelength);
        X += radiation * XYZ_match.value_X[w];
        Y += radiation * XYZ_match.value_Y[w];
        Z += radiation * XYZ_match.value_Z[w];
    }

    var colour = {
        X: X/Y * 100,
        Y: Y/Y * 100,
        Z: Z/Y * 100
    };
    return colour;
}

function change_temp(temp) {
    let col = kelvin_to_XYZ(temp);
    // xyz to srgb
    let matrix = [ 3.2404542, -1.5371385, -0.4985314,
                    -0.9692660,  1.8760108,  0.0415560,
                    0.0556434, -0.2040259,  1.0572252 ];
    let R = gamma ((col.X*matrix[0] + col.Y*matrix[1] + col.Z*matrix[2]));
    let G = gamma ((col.X*matrix[3] + col.Y*matrix[4] + col.Z*matrix[5]));
    let B = gamma ((col.X*matrix[6] + col.Y*matrix[7] + col.Z*matrix[8]));
    let max = Math.max(R, Math.max(G, B));
    console.log(max);
    R = R/max * 255;
    G = G/max * 255;
    B = B/max * 255;
    let style = "rgb("+parseInt(R).toString()+","+parseInt(G).toString()+","+parseInt(B).toString()+")";
    console.log("Temp: " + temp.toString() + " RGB: " + style);
    document.getElementById("Body").style = "background-color: " + style + ";";
    document.getElementById("TempLabel").innerHTML = temp.toString()+" Kelvin<br /><br />sRGB: "+parseInt(R).toString()+","+parseInt(G).toString()+","+parseInt(B).toString()+"<br /><br />XYZ: "+col.X.toPrecision(3).toString()+", "+col.Y.toPrecision(3).toString()+", "+col.Z.toPrecision(3).toString();
    if (R > 0) { if (G > 0) { if (B > 0) {return;} } }
    document.getElementById("TempLabel").innerHTML = document.getElementById("TempLabel").innerHTML.replace("n", "n (PREVIEW CLIPPED NOT ACCURATE)");
}

function slider() {
    change_temp(document.getElementById("TempSlider").value);
}

function test() {
    slider();
}
        </script>

<div style="margin: auto; width:50%;">
        <!-- https://en.wikipedia.org/wiki/Black_body -->
        <br></br>
        <code style="font-size:18px;">Blackbody to XYZ conversion using Planck's law and 1931 XYZ matching functions.</code>
        <br></br>
        <code id="TempLabel" style="font-size:18px;">y</code>
        <br></br>

        <input id="TempSlider" style="width: 100%;" type="range" min="1000" max="20000" value="5600" oninput="slider()" onchange="slider()"></input>
        </div>

    </body>

</html>
